<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.huangtl.blogmgr.model.blog.SystemMemo">

	<resultMap id="mapper" type="com.huangtl.blogmgr.model.blog.SystemMemo" >
		<id property="fId" column="memo_id"/>
		<result property="fParentId" column="memo_pid"/>
		<result property="fDescr" column="memo_descr" />
		<result property="fUrl" column="memo_url"/>
		<result property="fTitle" column="memo_title"/>
		<result property="fHierarchy" column="memo_hierarchy"/>
		<result property="fOrder" column="memo_order"/>
	</resultMap>
	
	<sql id="field">
		memo_id ,memo_pid ,memo_title ,memo_url, memo_order as fOrder
		<if test="fDescr_show != null">,memo_descr</if>
		<if test="fHierarchy_show != null">,memo_hierarchy</if>
	</sql>
	
	<sql id="where">
		 <trim prefix="where" prefixOverrides="and|or">
		 	<if test="defaultWhere != null and defaultWhere">
		 		1=1
		 	</if>
			<if test="fId_eq !=null ">
				and memo_id = #{fId_eq}
			</if>
			<if test="fId_in != null">
				and memo_id in
				<foreach collection="fId_in" open="(" item="id" separator="," close=")">
					#{id}
				</foreach>
			</if>
		</trim>
	</sql>
	
	<sql id="order">
		<if test="sorts != null and sorts.size() != 0">
			order by 
			<foreach collection="sorts" separator="," index="key" item="val">
				${key} ${val}
			</foreach>
		</if>
	</sql>
	
	<insert id="insert" parameterType="com.huangtl.blogmgr.model.blog.Role">
		insert into debug_system_memo(
			memo_id,memo_title,memo_url,memo_order,memo_descr
			<if test="fParentId != null">,memo_pid</if>
			<if test="fHierarchy != null ">,memo_hierarchy</if>
		) values(
			#{fId},#{fTitle},#{fUrl},#{fOrder},#{fDescr}
			<if test="fParentId !=null ">,#{fParentId}</if>
			<if test="fHierarchy != null ">,#{fHierarchy}</if>
		);
	</insert>
	
	<delete id="delete" parameterType="map">
		delete from debug_system_memo
		<include refid="where"></include>
	</delete>
	
	<update id="update" parameterType="map">
		update debug_system_memo 
		<trim prefix="set" suffixOverrides=",">
			<if test="fTitle !=null">memo_title = #{fTitle},</if>
			<if test="fUrl !=null">memo_url = #{fUrl},</if>
			<if test="fOrder !=null">memo_order = #{fOrder},</if>
			<if test="fDescr !=null">memo_descr = #{fDescr},</if>
		</trim>
		<include refid="where"/>
	</update>
	
	<update id="updateBatch" parameterType="list">
		<foreach collection="list" item="memo" index="index" open="" close="" separator=";">
			update debug_system_memo 
			<trim prefix="set" suffixOverrides=",">
				<if test="memo.fTitle !=null">memo_title = #{memo.fTitle},</if>
				<if test="memo.fUrl !=null">memo_url = #{memo.fUrl},</if>
				<if test="memo.fOrder !=null">memo_order = #{memo.fOrder},</if>
				<if test="memo.fDescr !=null">memo_descr = #{memo.fDescr},</if>
			</trim>
			 where memo_id = #{memo.fId}
		</foreach>
	</update>
	
	<select id="selectList" resultMap="mapper" parameterType="map">
		select 
			<include refid="field"/>
		from debug_system_memo
			<include refid="where"/>
	</select>
	
	<select id="selectCount"  resultType="long" parameterType="map">
	  select count(memo_id) 
	  from debug_system_memo
		<include refid="where"/>
	</select>
	
	<select id="selectPaging" resultMap="mapper" parameterType="map">
		select 
			<include refid="field"/>
		from debug_system_memo
			<include refid="where"/>
			<include refid="order"/>
		limit #{startIndex},#{pageSize}
	</select>
	
</mapper>